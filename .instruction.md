# TypeScript コーディングベストプラクティス

## 1. 型定義

### 明示的な型注釈
```typescript
// Good
const userName: string = "John";
const userAge: number = 25;

// Better - 型推論を活用
const userName = "John"; // string型として推論される
const userAge = 25; // number型として推論される
```

### インターフェースの活用
```typescript
// Good
interface User {
  id: number;
  name: string;
  email: string;
  isActive: boolean;
}

// オプショナルプロパティ
interface CreateUserRequest {
  name: string;
  email: string;
  age?: number; // オプショナル
}
```

## 2. 関数定義

### 関数の型定義
```typescript
// Good
function calculateTotal(price: number, tax: number): number {
  return price * (1 + tax);
}

// Arrow function
const calculateDiscount = (price: number, rate: number): number => {
  return price * rate;
};
```

### ジェネリクスの活用
```typescript
// Good
function identity<T>(arg: T): T {
  return arg;
}

// 複数の型パラメータ
function merge<T, U>(obj1: T, obj2: U): T & U {
  return { ...obj1, ...obj2 };
}
```

## 3. クラス設計

### アクセス修飾子の適切な使用
```typescript
class User {
  private _id: number;
  public name: string;
  protected email: string;

  constructor(id: number, name: string, email: string) {
    this._id = id;
    this.name = name;
    this.email = email;
  }

  public getId(): number {
    return this._id;
  }
}
```

### readonly プロパティ
```typescript
interface Config {
  readonly apiUrl: string;
  readonly timeout: number;
}
```

## 4. エラーハンドリング

### Result型パターン
```typescript
type Result<T, E = Error> = {
  success: true;
  data: T;
} | {
  success: false;
  error: E;
};

function parseJson<T>(json: string): Result<T> {
  try {
    const data = JSON.parse(json);
    return { success: true, data };
  } catch (error) {
    return { success: false, error: error as Error };
  }
}
```

## 5. 名前付け規則

### ファイル名
- `kebab-case`: `user-service.ts`, `api-client.ts`
- コンポーネント: `UserProfile.tsx`

### 変数・関数名
- `camelCase`: `userName`, `calculateTotal`
- Boolean: `isActive`, `hasPermission`, `canEdit`

### クラス・インターフェース名
- `PascalCase`: `User`, `ApiClient`, `DatabaseConnection`
- インターフェース: `IUser` または `User` (プロジェクトで統一)

### 定数
- `UPPER_SNAKE_CASE`: `API_BASE_URL`, `MAX_RETRY_COUNT`

## 6. ディレクトリ構造

```
src/
├── components/          # UIコンポーネント（共通・ページ別）
│   ├── common/
│   └── pages/
├── services/            # ビジネスロジックやAPI通信
├── types/               # TypeScript型定義
├── utils/               # ユーティリティ関数
├── hooks/               # カスタムフック（React使用時）
└── constants/           # 定数定義
├── docs/                # ドキュメントと開発日記
├── tests/               # テストファイル（単体・統合テスト）
│   ├── unit/
│   └── integration/
```



## 7. Import/Export

### Named Export を優先
```typescript
// Good
export const UserService = {
  create: (user: User) => { ... },
  update: (id: number, user: Partial<User>) => { ... }
};

// Import
import { UserService } from './services/user-service';
```

### バレルエクスポート
```typescript
// services/index.ts
export { UserService } from './user-service';
export { ApiClient } from './api-client';
```

## 8. 型安全性の向上

### Union Types
```typescript
type Status = 'pending' | 'approved' | 'rejected';
type Theme = 'light' | 'dark';
```

### Type Guards
```typescript
function isString(value: unknown): value is string {
  return typeof value === 'string';
}

function isUser(obj: unknown): obj is User {
  return typeof obj === 'object' && obj !== null && 'id' in obj;
}
```

### Utility Types
```typescript
interface User {
  id: number;
  name: string;
  email: string;
  age: number;
}

// 一部のプロパティのみ
type CreateUser = Omit<User, 'id'>;
type UpdateUser = Partial<Pick<User, 'name' | 'email'>>;
```

## 9. 非同期処理

### Promise と async/await
```typescript
async function fetchUser(id: number): Promise<User | null> {
  try {
    const response = await fetch(`/api/users/${id}`);
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    return await response.json();
  } catch (error) {
    console.error('Failed to fetch user:', error);
    return null;
  }
}
```

## 10. 設定ファイル

### tsconfig.json の推奨設定
```json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "strictFunctionTypes": true,
    "noImplicitReturns": true,
    "noImplicitThis": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true
  }
}
```

## 11. コメント

### JSDoc の活用
```typescript
/**
 * ユーザー情報を取得する
 * @param id - ユーザーID
 * @returns ユーザー情報、存在しない場合はnull
 * @throws APIエラーが発生した場合
 */
async function getUser(id: number): Promise<User | null> {
  // 実装
}
```

## 12. テスト

### 型安全なテスト
```typescript
import { User } from '../types';

describe('UserService', () => {
  it('should create user correctly', () => {
    const userData: Omit<User, 'id'> = {
      name: 'John Doe',
      email: 'john@example.com',
      age: 30
    };
    
    const user = UserService.create(userData);
    expect(user).toMatchObject(userData);
  });
});
```

## まとめ

- 型安全性を最優先にする
- 一貫した命名規則を守る
- エラーハンドリングを適切に行う
- コードの可読性と保守性を重視する
- TypeScriptの機能を活用してバグを未然に防ぐ
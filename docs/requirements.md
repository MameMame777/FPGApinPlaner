# FPGA Pin Planner GUI Tool - 要件定義書

## 1. プロジェクト概要

### 1.1 目的
FPGAのピン配置を視覚的に行うためのGUIツールを開発する。
ユーザーが直感的にピン配置を設計し、制約ファイル（XDC/SDC）を自動生成できるシステムを提供する。

### 1.2 対象ユーザー
- FPGA設計エンジニア
- デジタル回路設計者
- システム設計者

## 2. 機能要件

### 2.1 ファイル入出力機能

#### 2.1.1 CSV形式ピン情報の読み込み
- **要件**: CSV形式のピン情報ファイルを読み込める
- **詳細**: 
  - Xilinx公式フォーマット（Pin, Pin Name, Memory Byte Group, Bank等）に対応
  - 汎用CSVフォーマット（Pin, Signal, Direction, Voltage等）に対応
  - ヘッダー行の自動検出とマッピング
  - コメント行（#で始まる行）の自動スキップ
  - エラーハンドリング（不正な形式、存在しないファイル等）

#### 2.1.2 制約ファイル出力
- **要件**: ピン配置結果をもとにXDC/SDCファイルを生成
- **詳細**:
  - XDCファイル（Xilinx Design Constraints）形式対応
  - SDCファイル（Synopsys Design Constraints）形式対応
  - ユーザーが出力形式を選択可能

#### 2.1.3 外部ツール連携機能
- **要件**: 主要なFPGA開発ツールとの連携機能を提供
- **詳細**:
  - **Xilinx Vivado連携**:
    - XDCファイル生成（ピン配置制約）
    - TCLスクリプト生成（自動化用）
    - I/O Standard自動設定
    - 差動ペア制約の自動生成
  - **Intel Quartus連携**:
    - QSFファイル生成（Quartus Settings File）
    - ピン配置アサインメント自動設定
    - I/O Standard設定
    - Location Assignment生成
  - **データエクスポート機能**:
    - Excel形式でのピン配置表生成  
    - CSV形式での詳細データエクスポート
    - PDF形式でのピン配置レポート生成
    - 設計レビュー用ドキュメント自動生成
  - **PCB設計ツール連携**:
    - KiCad シンボルライブラリ生成
    - Altium Designer コンポーネント生成（将来対応）
    - ピン配置図の画像エクスポート（PNG/SVG）

### 2.2 ピン配置表示機能

#### 2.2.1 座標系
- **要件**: Y軸がアルファベット、X軸が数値の座標系でピン配置を表示
- **詳細**:
  - Y軸: A, B, C, ... (上から下へ)
  - X軸: 1, 2, 3, ... (左から右へ)
  - グリッド表示でピン位置を明確に表示

#### 2.2.2 ピン情報表示
- **要件**: 各ピンの詳細情報を表示
- **詳細**:
  - ピン番号（物理位置: A1, B2等）
  - ピン名（機能名: IO_L1P_T0_D00_MOSI_14等）
  - 信号名（ユーザー定義名）
  - ピンタイプ（IO/CONFIG/POWER/GROUND/MGT/CLOCK/ADC/SPECIAL）
  - バンク情報（Bank 0, 14, 15, 34, 216等）
  - メモリバイトグループ（0, 1, 2, 3）
  - I/Oタイプ（HR, HP, GTP, CONFIG等）
  - 電圧レベル（1.2V, 1.8V, 2.5V, 3.3V等）
  - 差動ペア情報（P/Nペアの関連付け）

### 2.3 表示制御機能

#### 2.3.1 90度回転機能
- **要件**: パッケージビューを90度単位で回転可能
- **詳細**:
  - 0°, 90°, 180°, 270°の4方向
  - 回転時の座標変換を自動実行
  - ピン配置の相対位置を維持

#### 2.3.2 トップ/ボトムビュー切り替え
- **要件**: パッケージの上面図と下面図を切り替え可能
- **詳細**:
  - トップビュー: パッケージ上面から見た配置
  - ボトムビュー: パッケージ下面から見た配置（左右反転）
  - 切り替え時の座標変換を自動実行

### 2.4 ピン編集機能

#### 2.4.1 ピン指定の編集
- **要件**: GUIでピンの指定を編集可能
- **詳細**:
  - ダブルクリックでピン属性の編集ダイアログを表示
  - 信号名、方向、電圧レベルの変更
  - ピン属性の編集
  - 未使用ピンの管理

#### 2.4.2 検索・フィルタ機能
- **要件**: 高度なピンの検索とフィルタリングが可能
- **詳細**:
  - **基本検索**:
    - 信号名による検索（ワイルドカード対応）
    - ピン番号による検索（範囲指定可能: A1-H18）
    - ピン名パターン検索（例: IO_L*P_T0*）
  - **フィルタリング**:
    - ピンタイプ別絞り込み（IO/CONFIG/POWER/GROUND/MGT等）
    - バンク別絞り込み（Bank 0, 14, 15, 34, 216等）
    - I/Oタイプ別絞り込み（HR, HP, GTP, CONFIG等）
    - 電圧レベル別絞り込み（1.2V, 1.8V, 2.5V, 3.3V等）
    - メモリバイトグループ別絞り込み（0, 1, 2, 3）
    - 割り当て状態別絞り込み（割り当て済み/未割り当て）
  - **高度な検索**:
    - 正規表現対応
    - 複合条件検索（AND/OR条件）
    - 差動ペア検索（P/Nペア）
    - 保存済みフィルタの呼び出し

    #### 2.4.3 視覚的に見やすい色分け
    - **要件**: ピンの種類や状態に応じて色分けを行う
    - **詳細**:
      - ピンタイプ別の色分け（例: IO=青, POWER=赤, GROUND=黒, CLOCK=緑、未接続=灰色）
      - 割り当て状態別の色分け（割り当て済み=濃色, 未割り当て=薄色）
      - 電圧レベル別の色分け（例: 1.2V=黄色, 1.8V=オレンジ, 3.3V=紫）
      - ユーザーがカスタム色を設定可能
      - 色分けの凡例を画面上に表示
    - **視覚効果**:
      - 色分けによりピン配置の状態を一目で把握可能
      - ツールチップで色の意味を補足表示
### 2.5 差動ペア管理機能

#### 2.5.1 差動ペア自動検出
- **要件**: P/Nペアの自動認識と管理
- **詳細**:
  - ピン名からの自動ペア検出（*P_*, *N_*パターン）
  - ペアの整合性チェック（同一バンク、同一グループ等）
  - 未ペアピンの警告表示
  - ペアの視覚的な関連付け表示
    - P/Nペアの線での結合表示

- **差動ペアの表示**:
  - 差動ペアをグループ化して表示


#### 2.5.2 制約ルールチェック
- **要件**: 設計ルール違反の自動検出
- **詳細**:
  - **バンク制約チェック**:
    - 同一バンク内の電圧レベル統一
    - バンクあたりの最大ピン数チェック
    - 特殊機能ピンの制約チェック（VREF, DQS等）
  - **クロック制約チェック**:
    - クロック専用ピンの適切な使用
    - クロックドメイン分離
    - クロック配線長の制約
  - **電源系統チェック**:
    - 電源ピンの適切な配置
    - グランドピンの配置バランス
    - デカップリング容量の考慮

### 2.6 レポート生成機能

#### 2.6.1 利用率レポート
- **要件**: パッケージとピンの利用状況を分析
- **詳細**:
  - 全体のピン利用率（使用ピン/総ピン数）
  - バンク別利用率（Bank 0, 14, 15, 34, 216等）
  - ピンタイプ別利用率（IO/CONFIG/POWER/GROUND/MGT等）
  - メモリバイトグループ別利用率
  - 未使用ピンのリスト表示

#### 2.6.2 設計品質レポート
- **要件**: 設計の品質と制約違反を分析
- **詳細**:
  - 制約違反の詳細リスト
  - 差動ペアマッチング状況
  - 電源・グランド配置バランス
  - クロック配線の妥当性
  - 推奨改善点の提示

### 2.7 プロジェクト管理機能

#### 2.7.1 プロジェクトファイル管理
- **要件**: 複数ファイルをプロジェクトとして統合管理
- **詳細**:
  - プロジェクト情報（デバイス名、パッケージ、速度グレード等）
  - 複数のピン配置ファイルの管理
  - 制約ファイルとの関連付け
  - バージョン管理とバックアップ機能

#### 2.7.2 コラボレーション機能
- **要件**: チーム開発を支援する機能
- **詳細**:
  - ピン単位でのコメント・注釈機能
  - 変更履歴の自動記録
  - レビュー機能（承認/却下/コメント）
  - 設計変更の差分表示

## 3. 非機能要件

### 3.1 パフォーマンス要件
- 1000ピン以上のパッケージでもスムーズに動作する
- ファイル読み込み時間: 10秒以内（1000ピン規模）
- 表示切り替え: 1秒以内

### 3.2 使いやすさ要件
- 直感的なGUIインターフェース
- ショートカットキー対応
- 操作のUndo/Redo機能

### 3.3 拡張性要件
- 新しいパッケージタイプへの対応が容易
- プラグイン機能（将来拡張）

## 4. 技術要件

### 4.1 開発環境
- TypeScript
- Electron（デスクトップアプリケーション）
- React（UIフレームワーク）

### 4.2 対応OS
- Windows 10/11
- macOS 10.15以降
- Linux（Ubuntu 18.04以降）

### 4.3 ファイル形式
- 入力: CSV, JSON
- 出力: XDC, SDC, CSV

## 5. データ要件

### 5.1 サンプルデータ
- **要件**: sampleディレクトリにサンプルファイルを配置
- **詳細**:
  - 複数のFPGAパッケージタイプのサンプル
  - CSVフォーマットの例
  - 制約ファイルの例

### 5.2 データ形式

#### 汎用CSVフォーマット
```csv
Pin,Signal,Direction,Voltage,Package_Pin,Row,Col
A1,CLK_IN,Input,3.3V,A1,A,1
A2,RST_N,Input,3.3V,A2,A,2
B1,DATA_OUT[0],Output,1.8V,B1,B,1
```

#### Xilinx公式フォーマット
```csv
Pin,Pin Name,Memory Byte Group,Bank,VCCAUX Group,Super Logic Region,I/O Type,No-Connect
A1,IO_L1P_T0_D00_MOSI_14,0,14,NA,NA,HR,NA
B1,IO_L1N_T0_D01_DIN_14,0,14,NA,NA,HR,NA
C1,DONE_0,NA,0,NA,NA,CONFIG,NA
```

## 6. 制約事項

### 6.1 技術的制約
- メモリ使用量: 1GB以内
- 対応パッケージサイズ: 最大2000ピン

### 6.2 運用制約
- インターネット接続不要（オフライン動作）
- 外部依存ライブラリの最小化

## 7. リスク分析

### 7.1 技術的リスク
- 大規模パッケージでのパフォーマンス低下
- 複雑な座標変換処理でのバグ

### 7.2 対策
- 仮想化表示による最適化
- 単体テストの充実
- 座標変換ライブラリの活用

## 8. 技術的実現性評価

### 8.1 実現性レベル分類

#### ✅ 高実現性（確実に実装可能）
- **基本機能**:
  - CSV形式ピン情報の読み込み
  - ピン配置表示（座標系、グリッド表示）
  - 90度回転、トップ/ボトムビュー切り替え
  - 基本的な検索・フィルタ機能
  - XDC/SDC制約ファイル出力

- **外部ツール連携**:
  - Vivado XDC/TCLファイル生成
  - Quartus QSFファイル生成
  - Excel/CSV形式でのデータエクスポート
  - KiCadシンボルライブラリ生成
  - PDF形式レポート生成
  - ピンリスト表示機能（ビューワーと同時に表示）

- **技術的根拠**:
  - 成熟したライブラリ（Papa Parse、Konva.js等）
  - 十分な技術資料とコミュニティサポート
  - 類似実装事例の存在
  - 標準的なファイル形式（XDC、QSF、CSV等）

#### ⚠️ 中実現性（注意深い設計が必要）
- **高度機能**:
  - 2000ピン規模でのパフォーマンス維持
  - 差動ペア自動検出・管理
  - リアルタイム制約ルールチェック
  - 高度な検索・フィルタ（正規表現等）

- **技術的課題**:
  - メモリ使用量とパフォーマンスのバランス
  - 複雑なアルゴリズムの実装難易度
  - ベンダー間の仕様差異への対応

#### 🔴 低実現性（段階的実装が必要）
- **高度機能**:
  - リアルタイムコラボレーション機能
  - 自動最適化による配置提案
  - 高度な信号品質解析
  - プラグインシステム

- **技術的理由**:
  - 実装複雑性が高い
  - 専門知識が必要
  - 開発リソースが大きい

### 8.2 パフォーマンス実現性

#### メモリ使用量見積もり
- **2000ピン規模**: 約3-5MB（目標1GB以内）
- **描画オブジェクト**: 仮想化により最適化可能
- **状態管理**: 効率的なデータ構造で管理

#### 処理速度目標
- **ファイル読み込み**: 10秒以内（達成可能）
- **表示切り替え**: 1秒以内（最適化により達成可能）
- **検索応答**: 500ms以内（インデックス化により達成可能）

### 8.3 開発工数見積もり

#### Phase 1: MVP機能（6ヶ月）
- ファイル入出力: 3週間
- 基本表示機能: 4週間
- 座標変換: 2週間
- 基本UI: 6週間
- 検索・フィルタ: 3週間
- 制約ファイル出力: 2週間
- **外部ツール連携**: 3週間
  - Vivado XDC/TCL生成
  - Quartus QSF生成
  - Excel/CSVエクスポート
  - KiCadシンボル生成
- テスト・統合: 4週間

#### Phase 2: 拡張機能（6-12ヶ月）
- 差動ペア管理: 6週間
- 制約ルールチェック: 8週間
- レポート生成: 4週間
- プロジェクト管理: 6週間

#### Phase 3: 高度機能（12-18ヶ月）
- コラボレーション機能: 12週間
- 高度分析機能: 16週間

### 8.4 技術的推奨事項

#### アーキテクチャ最適化
- **状態管理**: Redux → Zustand + Immer（軽量化）
- **描画エンジン**: Konva.js + 仮想化（パフォーマンス）
- **データ構造**: Map/Set の積極活用（高速アクセス）

#### 段階的開発戦略
1. **MVP優先**: 基本機能を確実に実装
2. **継続的最適化**: パフォーマンス問題に早期対応
3. **ユーザーフィードバック**: 実用性重視の機能選択

#### リスク軽減策
- 早期プロトタイプでの技術検証
- 段階的ユーザーテスト実施
- 継続的なパフォーマンス監視
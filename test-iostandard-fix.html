<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IOSTANDARD Fix Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .expected { color: #4CAF50; }
        .actual { color: #2196F3; }
        .error { color: #f44336; }
    </style>
</head>
<body>
    <h1>IOSTANDARD Fix Test - LVDS_25 Issue</h1>
    
    <div class="test-case">
        <h2>Test Case 1: LVDS_25 設定</h2>
        <p><strong>状況:</strong> ユーザーが GUI で LVDS_25 を選択</p>
        <p class="expected"><strong>期待結果:</strong> set_property IOSTANDARD LVDS_25 [get_ports ピン名]</p>
        <p><strong>修正前:</strong> <span class="error">set_property IOSTANDARD LVCMOS25 [get_ports ピン名]</span></p>
        <p class="actual"><strong>修正後:</strong> set_property IOSTANDARD LVDS_25 [get_ports ピン名]</p>
    </div>

    <div class="test-case">
        <h2>修正内容</h2>
        <h3>問題の原因</h3>
        <p>ExportService の exportToXDC() メソッドで、ユーザーが選択した I/O スタンダードを無視して、電圧値のみから決定していた。</p>
        
        <h3>修正内容</h3>
        <ul>
            <li>pin.attributes?.['IO_Standard'] または pin.ioType から実際の設定値を取得</li>
            <li>USER設定値が 'AUTO' でない場合は、その値を優先使用</li>
            <li>'AUTO' または未設定の場合のみ、電圧から getDefaultIOStandard() で決定</li>
        </ul>

        <h3>修正前のコード</h3>
        <pre><code>// I/O standard constraint (if available)
if (pin.voltage) {
  const iostandard = pin.voltage === '3.3V' ? 'LVCMOS33' : 
                    pin.voltage === '1.8V' ? 'LVCMOS18' :
                    pin.voltage === '2.5V' ? 'LVCMOS25' : 'LVCMOS33';
  lines.push(`set_property IOSTANDARD ${iostandard} [get_ports ${pin.signalName}]`);
}</code></pre>

        <h3>修正後のコード</h3>
        <pre><code>// I/O standard constraint (check user-selected first, then fall back to voltage-based default)
const userIOStandard = pin.attributes?.['IO_Standard'] || pin.ioType;
if (userIOStandard && userIOStandard !== 'AUTO') {
  lines.push(`set_property IOSTANDARD ${userIOStandard} [get_ports ${pin.signalName}]`);
} else if (pin.voltage) {
  const iostandard = getDefaultIOStandard(pin.voltage);
  lines.push(`set_property IOSTANDARD ${iostandard} [get_ports ${pin.signalName}]`);
}</code></pre>
    </div>

    <div class="test-case">
        <h2>テスト手順</h2>
        <ol>
            <li>FPGA Pin Planner を起動</li>
            <li>適当なピンを選択</li>
            <li>電圧を 2.5V に設定</li>
            <li>I/O Standard を LVDS_25 に設定</li>
            <li>XDC ファイルをエクスポート</li>
            <li>出力結果で "IOSTANDARD LVDS_25" が出力されることを確認</li>
        </ol>
    </div>

    <div class="test-case">
        <h2>対応可能な I/O Standards (2.5V)</h2>
        <ul>
            <li>LVCMOS25</li>
            <li><strong>LVDS_25</strong> ← この修正で対応</li>
            <li>RSDS_25</li>
            <li>BLVDS_25</li>
            <li>MINI_LVDS_25</li>
            <li>PPDS_25</li>
            <li>SSTL2_I</li>
            <li>SSTL2_II</li>
        </ul>
    </div>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FPGA Pin Planner - ãƒ†ã‚¹ãƒˆç’°å¢ƒ</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: #1e1e1e;
            color: #ffffff;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background-color: #2a2a2a;
            border-radius: 8px;
            border-left: 4px solid #4A90E2;
        }
        .success { border-left-color: #28a745; }
        .error { border-left-color: #dc3545; }
        .warning { border-left-color: #ffc107; }
        
        button {
            padding: 8px 16px;
            margin: 5px;
            background-color: #4A90E2;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover { background-color: #357abd; }
        .danger { background-color: #dc3545; }
        .danger:hover { background-color: #c82333; }
        
        .log {
            background-color: #1a1a1a;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 10px 0;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .status-card {
            background-color: #333;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª FPGA Pin Planner - çµ±åˆãƒ†ã‚¹ãƒˆç’°å¢ƒ</h1>
    
    <div class="status-grid">
        <div class="status-card">
            <h3>ğŸš€ é–‹ç™ºã‚µãƒ¼ãƒãƒ¼</h3>
            <div id="server-status">ç¢ºèªä¸­...</div>
            <button onclick="testServer()">ã‚µãƒ¼ãƒãƒ¼ãƒ†ã‚¹ãƒˆ</button>
        </div>
        
        <div class="status-card">
            <h3>ğŸ“Š CSVæ©Ÿèƒ½</h3>
            <div id="csv-status">æœªãƒ†ã‚¹ãƒˆ</div>
            <button onclick="testCSV()">CSVæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</button>
        </div>
        
        <div class="status-card">
            <h3>ğŸª ã‚¹ãƒˆã‚¢çŠ¶æ…‹</h3>
            <div id="store-status">æœªãƒ†ã‚¹ãƒˆ</div>
            <button onclick="testStore()">ã‚¹ãƒˆã‚¢ãƒ†ã‚¹ãƒˆ</button>
        </div>
    </div>
    
    <div class="test-section">
        <h3>ğŸ”§ ãƒ†ã‚¹ãƒˆæ“ä½œ</h3>
        <button onclick="openMainApp()">ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚’é–‹ã</button>
        <button onclick="openDevTools()">é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ã</button>
        <button onclick="clearLogs()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
        <button onclick="runAllTests()" class="danger">å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
    </div>
    
    <div class="test-section">
        <h3>ğŸ“ ãƒ†ã‚¹ãƒˆãƒ­ã‚°</h3>
        <div id="test-log" class="log">ãƒ†ã‚¹ãƒˆé–‹å§‹ã‚’å¾…æ©Ÿä¸­...</div>
    </div>
    
    <div class="test-section">
        <h3>ğŸ” ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–</h3>
        <div id="realtime-status" class="log">ç›£è¦–é–‹å§‹...</div>
    </div>

    <script>
        let logElement;
        let realtimeElement;
        
        document.addEventListener('DOMContentLoaded', () => {
            logElement = document.getElementById('test-log');
            realtimeElement = document.getElementById('realtime-status');
            
            log('ğŸš€ ãƒ†ã‚¹ãƒˆç’°å¢ƒãŒåˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ');
            startRealtimeMonitoring();
        });
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            console.log(logEntry);
            
            if (logElement) {
                logElement.innerHTML += logEntry + '<br>';
                logElement.scrollTop = logElement.scrollHeight;
            }
        }
        
        function updateStatus(elementId, message, type = '') {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = message;
                element.style.color = type === 'success' ? '#28a745' : 
                                    type === 'error' ? '#dc3545' : 
                                    type === 'warning' ? '#ffc107' : '#fff';
            }
        }
        
        async function testServer() {
            log('ğŸ” é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’ãƒ†ã‚¹ãƒˆä¸­...');
            updateStatus('server-status', 'ãƒ†ã‚¹ãƒˆä¸­...', '');
            
            try {
                const response = await fetch('http://localhost:5175');
                if (response.ok) {
                    updateStatus('server-status', 'âœ… æ­£å¸¸', 'success');
                    log('âœ… é–‹ç™ºã‚µãƒ¼ãƒãƒ¼: æ­£å¸¸å‹•ä½œç¢ºèª');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                updateStatus('server-status', 'âŒ ã‚¨ãƒ©ãƒ¼', 'error');
                log(`âŒ é–‹ç™ºã‚µãƒ¼ãƒãƒ¼: ${error.message}`);
            }
        }
        
        async function testCSV() {
            log('ğŸ“Š CSVæ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆä¸­...');
            updateStatus('csv-status', 'ãƒ†ã‚¹ãƒˆä¸­...', '');
            
            try {
                // CSVèª­ã¿è¾¼ã¿æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
                const csvContent = 'Pin,Pin Name,Bank\\nA1,TEST_PIN,14\\nB1,TEST_PIN2,15';
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const file = new File([blob], 'test.csv', { type: 'text/csv' });
                
                if (file.size > 0) {
                    updateStatus('csv-status', 'âœ… æ­£å¸¸', 'success');
                    log('âœ… CSVæ©Ÿèƒ½: ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆãƒ»èª­ã¿è¾¼ã¿æ­£å¸¸');
                } else {
                    throw new Error('ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã«å¤±æ•—');
                }
            } catch (error) {
                updateStatus('csv-status', 'âŒ ã‚¨ãƒ©ãƒ¼', 'error');
                log(`âŒ CSVæ©Ÿèƒ½: ${error.message}`);
            }
        }
        
        async function testStore() {
            log('ğŸª ã‚¹ãƒˆã‚¢æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆä¸­...');
            updateStatus('store-status', 'ãƒ†ã‚¹ãƒˆä¸­...', '');
            
            try {
                // LocalStorageã®ãƒ†ã‚¹ãƒˆ
                const testData = { test: 'data', timestamp: Date.now() };
                localStorage.setItem('fpga-test', JSON.stringify(testData));
                const retrieved = JSON.parse(localStorage.getItem('fpga-test'));
                
                if (retrieved && retrieved.test === 'data') {
                    // Immer MapSet ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ
                    try {
                        const testSet = new Set([1, 2, 3]);
                        log('âœ… Setæ“ä½œãƒ†ã‚¹ãƒˆ: ' + testSet.size + ' items');
                        const testMap = new Map([['key', 'value']]);
                        log('âœ… Mapæ“ä½œãƒ†ã‚¹ãƒˆ: ' + testMap.size + ' items');
                        
                        updateStatus('store-status', 'âœ… æ­£å¸¸', 'success');
                        log('âœ… ã‚¹ãƒˆã‚¢æ©Ÿèƒ½: LocalStorageèª­ã¿æ›¸ãæ­£å¸¸ã€Immer MapSetå¯¾å¿œ');
                    } catch (immerError) {
                        log('âš ï¸ Immer MapSetè­¦å‘Š: ' + immerError.message);
                        updateStatus('store-status', 'âš ï¸ éƒ¨åˆ†å¯¾å¿œ', 'warning');
                    }
                    localStorage.removeItem('fpga-test');
                } else {
                    throw new Error('ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ã‚¨ãƒ©ãƒ¼');
                }
            } catch (error) {
                updateStatus('store-status', 'âŒ ã‚¨ãƒ©ãƒ¼', 'error');
                log(`âŒ ã‚¹ãƒˆã‚¢æ©Ÿèƒ½: ${error.message}`);
            }
        }
        
        function openMainApp() {
            log('ğŸš€ ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ãã¾ã™...');
            window.open('http://localhost:5175', '_blank');
        }
        
        function openDevTools() {
            log('ğŸ”§ é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ãæŒ‡ç¤º...');
            alert('F12ã‚­ãƒ¼ã¾ãŸã¯å³ã‚¯ãƒªãƒƒã‚¯â†’æ¤œè¨¼ã§ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ã„ã¦ãã ã•ã„');
        }
        
        function clearLogs() {
            if (logElement) {
                logElement.innerHTML = '';
            }
            log('ğŸ—‘ï¸ ãƒ­ã‚°ãŒã‚¯ãƒªã‚¢ã•ã‚Œã¾ã—ãŸ');
        }
        
        async function runAllTests() {
            log('ğŸ”„ å…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™...');
            await testServer();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testCSV();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testStore();
            log('âœ… å…¨ãƒ†ã‚¹ãƒˆå®Œäº†');
        }
        
        function startRealtimeMonitoring() {
            setInterval(() => {
                const now = new Date();
                const status = `ç›£è¦–ä¸­... ${now.toLocaleTimeString()}`;
                if (realtimeElement) {
                    realtimeElement.innerHTML = status + '<br>' + 
                        `ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹: ${document.getElementById('server-status').textContent}<br>` +
                        `ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: ${(performance.memory ? (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(2) + 'MB' : 'ä¸æ˜')}`;
                }
            }, 1000);
        }
        
        // ã‚¨ãƒ©ãƒ¼ç›£è¦–
        window.addEventListener('error', (event) => {
            log(`âŒ JavaScriptã‚¨ãƒ©ãƒ¼: ${event.message} (${event.filename}:${event.lineno})`);
        });
        
        window.addEventListener('unhandledrejection', (event) => {
            log(`âŒ Promiseæ‹’å¦: ${event.reason}`);
        });
        
        // åˆæœŸãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        setTimeout(() => {
            testServer();
        }, 1000);
    </script>
</body>
</html>
